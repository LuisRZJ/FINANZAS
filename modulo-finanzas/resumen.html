<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTI - Gestor de Finanzas | Resumen</title>
    <meta name="theme-color" content="#2563eb">
    <link rel="icon" href="/pwa/logo-app.png">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="estilos.css">
    <script defer src="javascript.js"></script>
    <style>
        /* Usando la fuente Inter como predeterminada */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="text-gray-800 flex justify-center">

    <!-- Contenedor principal de la app -->
    <div class="w-full max-w-2xl bg-white shadow-lg relative min-h-screen">
        <!-- Contenido de la página con padding inferior para la barra de navegación -->
        <div id="resumenPageContent" class="p-4 sm:p-6 pb-44">

            <!-- Encabezado y Menú de 3 puntos -->
            <header class="mb-4 flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Resumen</h1>
                    <p class="text-gray-500">Tu panorama financiero de un vistazo.</p>
                </div>
                <div class="relative group">
                    <button class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
                    </button>
                    <div class="absolute right-0 w-48 pt-2 z-20 hidden group-hover:block">
                        <div class="bg-white rounded-md shadow-xl py-1">
                            <a href="/index.html" class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                Volver a inicio
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Selector de Cuenta -->
            <section class="mb-4">
                <div class="relative" id="resumenAccountsSelector">
                    <button id="resumenAccountsToggle" type="button" class="w-full flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg text-left hover:bg-gray-50 transition focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-haspopup="true" aria-expanded="false" aria-controls="resumenAccountsMenu">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-gray-100 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500">Mostrando resumen de</p>
                                <p id="resumenAccountsLabel" class="font-semibold text-gray-800">Todas las Cuentas</p>
                            </div>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>

                    <div id="resumenAccountsMenu" class="absolute left-0 mt-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg hidden z-20" role="dialog" aria-label="Filtro de cuentas">
                        <div class="p-3 border-b border-gray-100 flex items-center justify-between gap-3">
                            <p class="text-xs font-bold text-gray-500 uppercase tracking-wider">Filtrar cuentas</p>
                            <button id="resumenAccountsResetBtn" type="button" class="text-xs font-semibold text-indigo-600 hover:text-indigo-700">Todas</button>
                        </div>
                        <div class="p-3">
                            <div id="resumenAccountsList" class="space-y-2 max-h-56 overflow-auto"></div>
                            <div class="pt-3 flex items-center justify-between gap-3">
                                <p id="resumenAccountsHint" class="text-xs text-gray-400" aria-live="polite"></p>
                                <button id="resumenAccountsCloseBtn" type="button" class="text-xs font-semibold text-gray-600 hover:text-gray-800">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Controles de Periodo y Saldo -->
            <section class="mb-6 flex flex-col items-center sm:flex-row sm:justify-between bg-gray-50 p-3 rounded-lg gap-2">
                <div class="flex items-center gap-2 flex-wrap justify-center">
                    <!-- Selector de Temporalidad -->
                    <div class="relative" id="resumenPeriodSelector">
                        <button type="button" id="resumenPeriodToggle" class="flex items-center gap-1.5 text-sm font-medium bg-white px-3 py-2 rounded-lg hover:bg-gray-200 border border-gray-200 shadow-sm">
                            <span id="resumenPeriodLabel">Mensual</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </button>
                        <div id="resumenPeriodMenu" class="absolute left-0 mt-2 w-36 bg-white border border-gray-200 rounded-lg shadow-lg py-1 hidden z-20">
                            <button type="button" class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100" data-period-mode="monthly">Mensual</button>
                            <button type="button" class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100" data-period-mode="quarterly">Trimestral</button>
                            <button type="button" class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100" data-period-mode="annual">Anual</button>
                        </div>
                    </div>

                    <!-- Navegador de Periodo -->
                    <div class="flex items-center gap-1">
                        <button id="resumenPrevMonthBtn" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                        <span id="resumenCurrentMonthLabel" class="font-semibold text-lg text-gray-800 text-center w-32">Septiembre</span>
                        <button id="resumenNextMonthBtn" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="text-center sm:text-right flex-shrink-0 mt-2 sm:mt-0">
                    <p class="text-sm text-gray-500">Saldo total</p>
                    <p id="resumenTotalBalanceValue" class="text-lg font-bold text-indigo-600">$5,200.00</p>
                    <p id="resumenForecastValue" class="text-xs text-gray-500 mt-1 hidden" title="Saldo actual + Operaciones programadas del mes">
                        Proyección fin de mes: <span class="font-semibold text-gray-700">---</span>
                    </p>
                </div>
            </section>

            <!-- Resumen del Mes en Curso -->
            <section class="mb-6">
                <div class="bg-gray-100 rounded-xl p-4">
                    <h3 id="periodSummaryTitle" class="text-center text-sm font-semibold text-gray-600 mb-2 uppercase tracking-wide">Resumen del Periodo</h3>
                    
                    <div class="my-4">
                        <div class="flex justify-between text-xs font-medium text-gray-600 mb-1">
                            <span>Gastado: <span id="periodSpentLabel">—</span></span>
                            <span>Disponible: <span id="periodAvailableLabel">—</span></span>
                        </div>
                        <div id="periodBalanceBarBg" class="relative w-full bg-green-200 rounded-full h-6 overflow-hidden">
                            <div class="absolute inset-0 flex items-center justify-end pr-3">
                                <span id="periodAvailablePercent" class="text-green-900 font-bold text-sm">0%</span>
                            </div>
                            <div id="periodSpentBar" class="absolute top-0 left-0 h-full bg-red-400 rounded-full flex items-center justify-start pl-3" style="width: 0%;">
                                <span id="periodSpentPercent" class="text-white font-bold text-sm">0%</span>
                            </div>
                        </div>
                        <p class="text-center text-xs text-gray-500 mt-2">de un total de <span id="periodIncomeTotalInline" class="font-semibold">—</span> de ingresos</p>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center mt-4">
                        <div>
                            <p class="text-xs text-gray-500">Ingresos</p>
                            <p id="periodIncomeTotal" class="text-xl font-bold text-green-600">—</p>
                            <div id="periodIncomeDeltaRow" class="flex items-center justify-center text-xs mt-1 font-semibold h-4 text-gray-400">
                                <svg id="periodIncomeDeltaIconUp" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 11-6-6-6 6"/></svg>
                                <svg id="periodIncomeDeltaIconDown" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 13-6 6-6-6"/></svg>
                                <span id="periodIncomeDeltaText">—</span>
                            </div>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Gastos</p>
                            <p id="periodExpenseTotal" class="text-xl font-bold text-red-600">—</p>
                            <div id="periodExpenseDeltaRow" class="flex items-center justify-center text-xs mt-1 font-semibold h-4 text-gray-400">
                                <svg id="periodExpenseDeltaIconUp" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 11-6-6-6 6"/></svg>
                                <svg id="periodExpenseDeltaIconDown" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 13-6 6-6-6"/></svg>
                                <span id="periodExpenseDeltaText">—</span>
                            </div>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Balance</p>
                            <p id="periodBalanceTotal" class="text-xl font-bold text-blue-600">—</p>
                            <div id="periodBalanceDeltaRow" class="flex items-center justify-center text-xs mt-1 font-semibold h-4 text-gray-400">
                                <svg id="periodBalanceDeltaIconUp" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 11-6-6-6 6"/></svg>
                                <svg id="periodBalanceDeltaIconDown" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="mr-1 hidden"><path d="M12 5v14"/><path d="m18 13-6 6-6-6"/></svg>
                                <span id="periodBalanceDeltaText">—</span>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4 border-gray-200">
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Total Op.</p>
                            <p id="periodOpsTotalCount" class="text-lg font-bold text-gray-800">—</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Ingresos</p>
                            <p id="periodOpsIncomeCount" class="text-lg font-bold text-green-600">—</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Gastos</p>
                            <p id="periodOpsExpenseCount" class="text-lg font-bold text-red-600">—</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 mb-1">Transfer.</p>
                            <p id="periodOpsTransferCount" class="text-lg font-bold text-indigo-600">—</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Botones de Acción -->
            <section class="mb-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button id="openBudgetsModal" class="bg-blue-50 hover:bg-blue-100 text-blue-700 font-semibold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pie-chart"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                    Gestionar Presupuestos
                </button>
                <button id="openSavingsModal" class="bg-green-50 hover:bg-green-100 text-green-700 font-semibold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-piggy-bank"><path d="M15.174 11.341a1.5 1.5 0 0 1 2.405 1.71l-2.42 4.84a1.5 1.5 0 0 1-2.659-.516l-2.42-4.84a1.5 1.5 0 0 1 2.405-1.71l.244.122a.5.5 0 0 0 .49 0l.244-.122z"/><path d="M8 12h.01"/><path d="M4.23 6.52a25.48 25.48 0 0 0-1.03 3.51c-1.2 5.07.12 9.97 4.3 10.94a2.5 2.5 0 0 0 3.17-1.19l.2-1.17a2.5 2.5 0 0 1 2.2-1.95h.28a2.5 2.5 0 0 1 2.2 1.95l.2 1.17a2.5 2.5 0 0 0 3.17 1.19c4.18-.97 5.5-5.87 4.3-10.94a25.48 25.48 0 0 0-1.03-3.51"/><path d="m7.26 7.2-2.52 2.52"/><path d="m16.74 7.2 2.52 2.52"/></svg>
                    Gestionar Ahorros
                </button>
            </section>

            <!-- Presupuestos y Ahorros -->
            <section class="mb-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Presupuestos -->
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h3 class="font-bold text-gray-800 mb-4">Presupuestos Destacados</h3>
                    <div id="featuredBudgetsSummary" class="bg-gray-50 rounded-xl border border-gray-100 p-3 mb-4 hidden">
                        <div class="flex items-center justify-between">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Resumen mensual</p>
                            <p id="featuredBudgetsCurrency" class="text-[10px] font-bold text-gray-400 uppercase tracking-wider"></p>
                        </div>
                        <div class="grid grid-cols-3 gap-3 mt-2">
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Total</p>
                                <p id="featuredBudgetsTotal" class="font-bold text-gray-800 text-sm">—</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Asignado</p>
                                <p id="featuredBudgetsAssigned" class="font-bold text-gray-800 text-sm">—</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Disponible</p>
                                <p id="featuredBudgetsAvailable" class="font-bold text-gray-800 text-sm">—</p>
                            </div>
                        </div>
                        <div class="mt-2">
                            <div id="featuredBudgetsAssignedBar" class="w-full bg-gray-200 rounded-full h-2.5 flex overflow-hidden">
                                <!-- Segments generated via JS -->
                            </div>
                        </div>
                    </div>
                    <div id="featuredBudgetsList" class="space-y-4">
                        <div class="text-center py-4">
                            <p class="text-xs text-gray-400 italic">No hay presupuestos configurados.</p>
                        </div>
                    </div>
                </div>
                <!-- Ahorros -->
                <div class="bg-white p-4 rounded-xl border border-gray-200">
                    <h3 class="font-bold text-gray-800 mb-4">Ahorros Destacados</h3>
                    <div id="featuredSavingsList" class="space-y-4">
                        <!-- Los ahorros se cargarán aquí dinámicamente -->
                        <div class="text-center py-4">
                            <p class="text-xs text-gray-400 italic">No hay ahorros configurados.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Extremos del Mes -->
            <section class="mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">Extremos del Mes</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Gasto Mínimo -->
                    <div id="extremeExpenseMin" class="bg-white p-4 rounded-lg border border-gray-200 hidden">
                        <p class="text-xs font-medium text-red-800 uppercase">Gasto Mínimo</p>
                        <div class="flex items-center gap-3 mt-2">
                             <div class="p-2 bg-red-100 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-600"><path d="M17 8h.01"/><path d="M15.5 13.5c1.2-1.2 1.1-3.1-.1-4.2-1.2-1.2-3.1-1.1-4.2.1-1.2 1.2-1.1 3.1.1 4.2.9.9 2.2 1.2 3.3 1.1"/><path d="m22 2-1.5 1.5M19 16l-2.3 2.3c-1.1 1-2.5 1.5-4 1.5-2.3 0-4.4-1.2-5.7-3.2-1-1.5-1.3-3.4-1-5.2s1.1-3.4 2.5-4.4C9.9 5.8 12.2 5 14.5 5c1.4 0 2.8.4 4 1.2"/></svg>
                            </div>
                            <div class="flex-grow">
                                <p class="font-semibold text-gray-800 truncate name">--</p>
                                <p class="text-sm font-bold text-red-600 amount">-- <span class="font-normal text-gray-500 text-xs date">--</span></p>
                            </div>
                        </div>
                    </div>
                    <!-- Gasto Máximo -->
                    <div id="extremeExpenseMax" class="bg-red-50 p-4 rounded-lg border-2 border-red-100 hidden">
                        <p class="text-xs font-medium text-red-800 uppercase">Gasto Máximo</p>
                         <div class="flex items-center gap-3 mt-2">
                            <div class="p-2 bg-red-200 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-700"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            </div>
                            <div class="flex-grow">
                                <p class="font-semibold text-gray-800 truncate name">--</p>
                                <p class="text-sm font-bold text-red-600 amount">-- <span class="font-normal text-gray-500 text-xs date">--</span></p>
                            </div>
                        </div>
                    </div>
                    <!-- Ingreso Mínimo -->
                    <div id="extremeIncomeMin" class="bg-white p-4 rounded-lg border border-gray-200 hidden">
                        <p class="text-xs font-medium text-green-800 uppercase">Ingreso Mínimo</p>
                         <div class="flex items-center gap-3 mt-2">
                             <div class="p-2 bg-green-100 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600"><path d="M12 2v10"/><path d="M18.4 6.6a9 9 0 1 1-12.77.04"/><path d="M21.12 15.34A9 9 0 0 0 12 3a9 9 0 0 0-9.12 12.34"/></svg>
                            </div>
                            <div class="flex-grow">
                                <p class="font-semibold text-gray-800 truncate name">--</p>
                                <p class="text-sm font-bold text-green-600 amount">-- <span class="font-normal text-gray-500 text-xs date">--</span></p>
                            </div>
                        </div>
                    </div>
                    <!-- Ingreso Máximo -->
                    <div id="extremeIncomeMax" class="bg-green-50 p-4 rounded-lg border-2 border-green-100 hidden">
                        <p class="text-xs font-medium text-green-800 uppercase">Ingreso Máximo</p>
                         <div class="flex items-center gap-3 mt-2">
                             <div class="p-2 bg-green-200 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-700"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                            </div>
                            <div class="flex-grow">
                                <p class="font-semibold text-gray-800 truncate name">--</p>
                                <p class="text-sm font-bold text-green-600 amount">-- <span class="font-normal text-gray-500 text-xs date">--</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


            <!-- Movimientos Destacados del Mes -->
            <section>
                <h2 class="text-xl font-bold text-gray-900 mb-4">Movimientos Destacados</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Mayores Ingresos -->
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 mb-3 text-center uppercase tracking-wider">Mayores Ingresos</h3>
                        <div id="featuredIncomesList" class="space-y-3">
                            <div class="text-center py-4">
                                <p class="text-xs text-gray-400 italic">No hay ingresos registrados.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gastos Más Altos -->
                     <div>
                        <h3 class="text-sm font-semibold text-gray-500 mb-3 text-center uppercase tracking-wider">Gastos Más Altos</h3>
                        <div id="featuredExpensesList" class="space-y-3">
                            <div class="text-center py-4">
                                <p class="text-xs text-gray-400 italic">No hay gastos registrados.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <br><br>

        <div id="budgetsModal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
            <div class="relative w-full h-full sm:h-auto sm:max-w-xl mx-auto sm:mt-10 bg-white sm:rounded-2xl shadow-2xl overflow-hidden flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-300">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 9a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V9z"></path><path d="M11 9V6a1 1 0 0 1 1-1h.5a2 2 0 0 0 0-4H12a5 5 0 0 0-5 5v3"></path><path d="M18 21a1.5 1.5 0 0 0 1.5-1.5v-1.5A1.5 1.5 0 0 0 18 16.5h-1.5v-3H18A1.5 1.5 0 0 0 19.5 12V9A1.5 1.5 0 0 0 18 7.5h-1.5v-3H18A1.5 1.5 0 0 0 19.5 3V1.5A1.5 1.5 0 0 0 18 .5h-1.5a2 2 0 0 0-2 2V3a1 1 0 0 0 1 1h1.5v3H15a1.5 1.5 0 0 0-1.5 1.5V12a1.5 1.5 0 0 0 1.5 1.5h1.5v3H15a1.5 1.5 0 0 0-1.5 1.5v1.5A1.5 1.5 0 0 0 15 21h1.5v2.5a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V21z"></path></svg>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">Presupuesto mensual</h3>
                            <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold" id="budgetsModalSubtitle">RECURRE PARA FUTUROS MESES</p>
                        </div>
                    </div>
                    <button id="closeBudgetsModal" class="p-2 rounded-full text-gray-400 hover:bg-gray-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>

                <div class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar">
                    <div class="bg-gray-50 rounded-xl p-4 border border-gray-100 space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500">Total mensual</label>
                                <input id="budgetTotalAmount" type="number" inputmode="decimal" min="0" step="0.01" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0.00">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500">Aplica desde</label>
                                <input id="budgetEffectiveFrom" type="month" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                            </div>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-100 p-4">
                            <div class="flex items-center justify-between">
                                <p class="text-xs font-bold text-gray-500 uppercase tracking-wider">Resumen</p>
                                <p class="text-[11px] font-semibold text-gray-400" id="budgetCurrencyLabel"></p>
                            </div>
                            <div class="grid grid-cols-3 gap-3 mt-3">
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Total</p>
                                    <p id="budgetsSummaryTotal" class="font-bold text-gray-800 text-sm">—</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Asignado</p>
                                    <p id="budgetsSummaryAssigned" class="font-bold text-gray-800 text-sm">—</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase tracking-wider font-bold">Disponible</p>
                                    <p id="budgetsSummaryAvailable" class="font-bold text-gray-800 text-sm">—</p>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div id="budgetsAssignedBar" class="w-full bg-gray-200 rounded-full h-2.5 flex overflow-hidden">
                                    <!-- Segments generated via JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-gray-100 p-4 space-y-3">
                        <div class="flex items-center justify-between">
                            <p class="text-xs font-bold text-gray-500 uppercase tracking-wider">Subpresupuestos</p>
                            <input id="editingSubBudgetId" type="hidden">
                        </div>
                        <div class="grid grid-cols-1 gap-3">
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500">Categoría de gasto</label>
                                <select id="budgetCategorySelect" class="w-full bg-gray-100 border border-gray-200 rounded-lg p-2 text-sm" required></select>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold text-gray-500">Monto mensual</label>
                                    <input id="budgetCategoryAmount" type="number" inputmode="decimal" min="0" step="0.01" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0.00">
                                </div>
                                <div class="flex items-end gap-2">
                                    <button id="saveSubBudgetBtn" class="flex-1 py-2 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition shadow-md">Agregar</button>
                                    <button id="cancelSubBudgetEditBtn" class="py-2 px-3 text-sm font-semibold text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition hidden">Cancelar</button>
                                </div>
                            </div>
                        </div>
                        <div id="budgetsSubBudgetsList" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="savingsModal" class="fixed inset-0 z-50 hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
            <div class="relative w-full h-full sm:h-auto sm:max-w-xl mx-auto sm:mt-10 bg-white sm:rounded-2xl shadow-2xl overflow-hidden flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-300">
                <!-- Cabecera del Modal -->
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3.5 9.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0z"></path><path d="M19.5 9.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"></path><path d="M12 12a5 5 0 0 1 5 5v3H7v-3a5 5 0 0 1 5-5z"></path></svg>
                        </div>
                        <h3 class="font-bold text-gray-800 text-lg">Metas de Ahorro</h3>
                    </div>
                    <button id="closeSavingsModal" class="p-2 rounded-full text-gray-400 hover:bg-gray-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>

                <!-- Cuerpo del Modal -->
                <div class="flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar">
                    <!-- Lista de Metas -->
                    <div id="savingsGoalsList" class="flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory custom-scrollbar">
                        <!-- Las metas se cargarán aquí dinámicamente -->
                        <div class="text-center py-8 w-full">
                            <p class="text-gray-400 italic">No tienes metas de ahorro configuradas.</p>
                        </div>
                    </div>

                    <!-- Formulario para Nueva Meta (Oculto por defecto) -->
                    <div id="newGoalForm" class="hidden bg-gray-50 rounded-xl p-4 border border-gray-100 space-y-4">
                        <h4 id="goalFormTitle" class="font-bold text-gray-700 text-sm uppercase tracking-wider">Nueva Meta</h4>
                        <input type="hidden" id="goalIdField">
                        <div class="grid grid-cols-1 gap-4">
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500">Nombre de la meta</label>
                                <input type="text" id="goalName" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Ej. Viaje a Japón">
                            </div>
                            <div class="space-y-1">
                                <label class="text-xs font-semibold text-gray-500">Descripción (opcional, máx. 100 car.)</label>
                                <textarea id="goalDescription" maxlength="100" rows="2" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none resize-none" placeholder="Ahorro mensual para el boleto..."></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold text-gray-500">Monto Objetivo</label>
                                    <input type="number" id="goalTarget" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0.00">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold text-gray-500">Monto Inicial</label>
                                    <input type="number" id="goalCurrent" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="0.00" value="0">
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="flex-grow space-y-1">
                                    <label class="text-xs font-semibold text-gray-500">Color distintivo</label>
                                    <div class="flex flex-wrap gap-2">
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-indigo-500 ring-2 ring-offset-2 ring-indigo-500" data-color="indigo"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-blue-500" data-color="blue"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-cyan-500" data-color="cyan"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-teal-500" data-color="teal"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-green-500" data-color="green"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-amber-500" data-color="amber"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-orange-500" data-color="orange"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-rose-500" data-color="rose"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-purple-500" data-color="purple"></button>
                                        <button type="button" class="color-opt w-6 h-6 rounded-full bg-slate-500" data-color="slate"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 pt-2">
                            <button id="cancelGoal" class="flex-grow py-2 text-sm font-semibold text-gray-500 hover:bg-gray-200 rounded-lg transition">Cancelar</button>
                            <button id="saveGoal" class="flex-grow py-2 text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition shadow-md">Guardar Meta</button>
                        </div>
                    </div>
                </div>

                <!-- Pie del Modal -->
                <div class="p-4 border-t border-gray-100 bg-white">
                    <button id="showNewGoalForm" class="w-full flex items-center justify-center gap-2 py-3 bg-indigo-50 text-indigo-700 font-bold rounded-xl hover:bg-indigo-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Agregar Nueva Meta
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal para Historial de Metas -->
        <div id="historyModal" class="fixed inset-0 z-[70] hidden">
            <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
            <div class="relative w-full max-w-md mx-auto mt-20 bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[70vh] animate-in fade-in zoom-in duration-200">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                    <div class="flex items-center gap-3">
                        <div id="historyModalIcon" class="p-2 bg-indigo-100 rounded-lg text-indigo-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <div>
                            <h3 id="historyModalTitle" class="font-bold text-gray-800 text-lg">Historial de Meta</h3>
                            <p id="historyModalSubtitle" class="text-[10px] text-gray-400 uppercase tracking-widest font-bold"></p>
                        </div>
                    </div>
                    <button id="closeHistoryModal" class="p-2 rounded-full text-gray-400 hover:bg-gray-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div id="historyList" class="flex-grow min-h-0 overflow-y-auto p-6 space-y-4">
                    <!-- Los items del historial se cargarán aquí -->
                </div>
            </div>
        </div>

        <!-- Barra de Navegación Inferior -->
        <footer class="fixed bottom-0 left-0 right-0 max-w-2xl mx-auto bg-white border-t border-gray-200">
            <div class="grid grid-cols-5 items-center justify-items-center h-16">
                <!-- Resumen (Activo) -->
                <a href="#" class="flex flex-col items-center justify-center text-indigo-600 w-full h-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span class="text-xs font-medium">Resumen</span>
                </a>
                <!-- Operaciones -->
                <a href="operaciones.html" class="flex flex-col items-center justify-center text-gray-500 hover:text-indigo-600 w-full h-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                    <span class="text-xs font-medium">Operaciones</span>
                </a>
                <!-- Estadísticas -->
                <a href="estadisticas.html" class="flex flex-col items-center justify-center text-gray-500 hover:text-indigo-600 w-full h-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
                    <span class="text-xs font-medium">Estadísticas</span>
                </a>
                <!-- Cuentas -->
                <a href="cuentas.html" class="flex flex-col items-center justify-center text-gray-500 hover:text-indigo-600 w-full h-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>
                    <span class="text-xs font-medium">Cuentas</span>
                </a>
                <!-- Ajustes -->
                 <a href="ajustes.html" class="flex flex-col items-center justify-center text-gray-500 hover:text-indigo-600 w-full h-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mb-1"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    <span class="text-xs font-medium">Ajustes</span>
                </a>
            </div>
        </footer>
    </div>

</body>
</html>
