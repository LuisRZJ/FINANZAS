<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diario Trading Forex - Ajustes</title>

    <!-- Tailwind CSS CDN -->
    <script>
        (function () {
            const match = document.cookie.match(/(?:^|;\s*)theme=([^;]+)/);
            if (match && decodeURIComponent(match[1]) === 'dark') document.documentElement.classList.add('dark');
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        orange: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            500: '#f97316',
                            600: '#ea580c',
                            700: '#c2410c',
                        },
                    },
                },
            },
        };
        if (typeof tailwind !== 'undefined' && typeof tailwind.refresh === 'function') {
            tailwind.refresh();
        }
    </script>

    <!-- Google Fonts (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Manifest and Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="Logo_app_trading-removebg-preview.png">
    <link rel="icon" type="image/png" sizes="512x512" href="Logo_app_trading-removebg-preview.png">

    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <style>
        /* Estilos base y para el menú, integrados con la lógica JS existente */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Clases para controlar la visibilidad del menú lateral sin modificar el JS */
        .nav-menu.visible {
            transform: translateX(0);
        }

        .menu-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        body.menu-open {
            position: fixed;
            width: 100%;
            overflow: hidden;
        }

        /* Estilo para ocultar el botón del menú cuando el menú está abierto */
        .menu-toggle.opened {
            transform: translateX(-150%);
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        }

        /* Estilos para la lista de estrategias generada por JS */
        #built-in-strategy-list li,
        #custom-strategy-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: #f9fafb;
            /* bg-gray-50 */
            border: 1px solid #e5e7eb;
            /* border-gray-200 */
            border-radius: 0.5rem;
            /* rounded-lg */
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }

        .dark #built-in-strategy-list li,
        .dark #custom-strategy-list li {
            background-color: #374151;
            /* bg-gray-700 */
            border-color: #4b5563;
            /* border-gray-600 */
            color: #e5e7eb;
            /* text-gray-200 */
        }

        .strategy-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Estilos para botones generados por JS (nav-btn) */
        .nav-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .nav-btn.secondary {
            background-color: #e5e7eb;
            /* bg-gray-200 */
            color: #1f2937;
            /* text-gray-800 */
        }

        .nav-btn.secondary:hover {
            background-color: #d1d5db;
            /* hover:bg-gray-300 */
        }

        .dark .nav-btn.secondary {
            background-color: #4b5563;
            /* dark:bg-gray-600 */
            color: #e5e7eb;
            /* dark:text-gray-200 */
        }

        .dark .nav-btn.secondary:hover {
            background-color: #6b7280;
            /* dark:hover:bg-gray-500 */
        }

        .nav-btn.clear {
            background-color: #fee2e2;
            /* bg-red-100 */
            color: #991b1b;
            /* text-red-800 */
        }

        .nav-btn.clear:hover {
            background-color: #fecaca;
            /* hover:bg-red-200 */
        }

        .dark .nav-btn.clear {
            background-color: #7f1d1d;
            /* dark:bg-red-900 */
            color: #fecaca;
            /* dark:text-red-200 */
        }

        .dark .nav-btn.clear:hover {
            background-color: #991b1b;
            /* dark:hover:bg-red-800 */
        }
    </style>
</head>

<body class="bg-orange-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <!-- Botón del Menú Hamburguesa -->
    <button
        class="menu-toggle fixed z-50 top-4 left-4 w-12 h-12 bg-white dark:bg-gray-800 rounded-full shadow-lg flex items-center justify-center text-2xl text-gray-700 dark:text-gray-300 transition-all duration-300 ease-in-out"
        onclick="toggleMenu()">
        ☰
    </button>

    <!-- Overlay del Menú -->
    <div
        class="menu-overlay fixed inset-0 bg-black bg-opacity-50 z-30 opacity-0 pointer-events-none transition-opacity duration-300">
    </div>

    <!-- Menú de Navegación Lateral -->
    <nav
        class="nav-menu fixed top-0 left-0 h-full w-72 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md shadow-xl z-40 transform -translate-x-full transition-transform duration-300 ease-in-out">
        <div class="p-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Menú</h2>
                <!-- Botón de Cierre (dentro del menú) -->
                <button
                    class="w-10 h-10 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition-colors"
                    onclick="toggleMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="menu-items space-y-2">
                <a href="index.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    <span>Inicio</span>
                </a>
                <a href="/index.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="7" height="9" x="3" y="3" rx="1" />
                        <rect width="7" height="5" x="14" y="3" rx="1" />
                        <rect width="7" height="9" x="14" y="12" rx="1" />
                        <rect width="7" height="5" x="3" y="16" rx="1" />
                    </svg>
                    <span>Volver al panel de control</span>
                </a>
                <a href="registrar-trade.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M8 12h8" />
                        <path d="M12 8v8" />
                    </svg>
                    <span>Registrar Trade</span>
                </a>
                <a href="diario.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
                    </svg>
                    <span>Diario</span>
                </a>
                <a href="estadisticas.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 3v18h18" />
                        <path d="M18 17V9" />
                        <path d="M13 17V5" />
                        <path d="M8 17v-3" />
                    </svg>
                    <span>Estadísticas</span>
                </a>
                <a href="plan-trading.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
                        <path d="M14 2v4a2 2 0 0 0 2 2h4" />
                        <path d="M10 9H8" />
                        <path d="M16 13H8" />
                        <path d="M16 17H8" />
                    </svg>
                    <span>Plan de Trading</span>
                </a>
                <a href="almacenamiento.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <ellipse cx="12" cy="5" rx="9" ry="3" />
                        <path d="M3 5V19A9 3 0 0 0 21 19V5" />
                        <path d="M3 12A9 3 0 0 0 21 12" />
                    </svg>
                    <span>Almacenamiento</span>
                </a>
                <a href="ajustes.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    <span>Ajustes</span>
                </a>
                <a href="deposito-retiro.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3 4 7l4 4" />
                        <path d="M4 7h16" />
                        <path d="m16 21 4-4-4-4" />
                        <path d="M20 17H4" />
                    </svg>
                    <span>Deposito/Retiro</span>
                </a>
                <a href="gestor-cuentas.html"
                    class="flex items-center gap-3 py-2.5 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    <span>Gestor de Cuentas</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 pt-24">
        <!-- Encabezado -->
        <header class="mb-8">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Ajustes</h1>
                <div id="datetime" class="text-sm text-gray-500 dark:text-gray-400"></div>
            </div>
            <div class="account-switcher mt-4 flex flex-wrap items-center gap-2">
                <label for="account-select" class="text-sm font-medium">Cuenta:</label>
                <select id="account-select"
                    class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500"></select>
                <button type="button" id="add-account-btn"
                    class="nav-btn px-4 py-2 bg-orange-600 text-white rounded-lg text-sm font-semibold hover:bg-orange-700 transition">Nueva
                    cuenta</button>
                <span id="active-account-name" class="account-name ml-2 font-semibold"></span>
            </div>
        </header>

        <!-- Contenedor de Ajustes -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Tema de la Aplicación -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Tema de la Aplicación</h3>
                <div class="flex gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="theme" value="light" id="theme-light"
                            class="w-4 h-4 text-orange-600 focus:ring-orange-500">
                        <span class="text-gray-700 dark:text-gray-300">Tema Claro</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="theme" value="dark" id="theme-dark"
                            class="w-4 h-4 text-orange-600 focus:ring-orange-500">
                        <span class="text-gray-700 dark:text-gray-300">Tema Oscuro</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="theme" value="auto" id="theme-auto"
                            class="w-4 h-4 text-orange-600 focus:ring-orange-500">
                        <span class="text-gray-700 dark:text-gray-300">Automático</span>
                    </label>
                </div>
            </div>

            <!-- Meta -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Meta</h3>
                <div class="space-y-4">
                    <div class="flex flex-col sm:flex-row gap-4">
                        <div class="flex-1">
                            <label
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Período</label>
                            <select id="goal-period"
                                class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                                <option value="daily">Diaria</option>
                                <option value="weekly">Semanal</option>
                                <option value="monthly">Mensual</option>
                                <option value="yearly">Anual</option>
                            </select>
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Monto</label>
                            <input type="number" id="monthly-goal" min="0" step="100" placeholder="Ingrese su meta"
                                class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        </div>
                    </div>
                    <button id="save-goal"
                        class="w-full sm:w-auto px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">Guardar
                        Meta</button>
                </div>
            </div>

            <!-- Nombre de Usuario -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Nombre de Usuario</h3>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="username" placeholder="Ingrese su nombre"
                        class="flex-1 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <button id="save-username"
                        class="px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">Guardar
                        Nombre</button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Webhook de Discord</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Se usará para enviar el archivo de exportación desde Almacenamiento.</p>
                <div class="space-y-3">
                    <label for="discord-webhook-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300">URL del Webhook</label>
                    <input type="url" id="discord-webhook-url" inputmode="url" autocomplete="off" spellcheck="false" placeholder="https://discord.com/api/webhooks/..."
                        class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button id="save-discord-webhook"
                            class="px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">Guardar</button>
                        <button id="clear-discord-webhook"
                            class="px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">Eliminar</button>
                    </div>
                </div>
            </div>

            <!-- Capital Inicial -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Capital Inicial del Broker</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">Úsalo si inicias con un bono o si estás probando una cuenta demo con un saldo predefinido.</p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="number" id="initial-capital" min="0" step="1000"
                        placeholder="Ingrese su capital inicial"
                        class="flex-1 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <button id="save-capital"
                        class="px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">Guardar
                        Capital</button>
                </div>
            </div>

            <!-- Mis Estrategias Personalizadas -->
            <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md" id="strategy-management">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Mis Estrategias Personalizadas</h3>

                <form id="strategy-add-form" class="flex flex-col sm:flex-row gap-4 mb-6">
                    <input type="text" id="new-strategy-name" maxlength="80" placeholder="Nombre de la estrategia"
                        class="flex-1 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                    <button type="submit"
                        class="px-6 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition">Agregar
                        Estrategia</button>
                </form>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Predefinidas -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 dark:text-gray-300 mb-3">Predefinidas</h4>
                        <ul id="built-in-strategy-list" class="space-y-2">
                            <!-- Lista generada por JS -->
                        </ul>
                    </div>

                    <!-- Creadas por mí -->
                    <div>
                        <h4 class="text-md font-medium text-gray-700 dark:text-gray-300 mb-3">Creadas por mí</h4>
                        <p id="custom-strategy-empty" class="text-gray-500 dark:text-gray-400 text-sm italic mb-2">Aún
                            no has agregado estrategias.</p>
                        <ul id="custom-strategy-list" class="space-y-2">
                            <!-- Lista generada por JS -->
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="javascript.js"></script>
    <script>
        // --- LÓGICA DE UI (Copiada de index.html) ---

        // Función para obtener una cookie
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Función para establecer una cookie
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        // Actualizar fecha y hora
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const dateElement = document.getElementById('datetime');
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('es-ES', options);
            }
        }

        setInterval(updateDateTime, 1000);
        updateDateTime();

        // Cargar tema guardado
        function loadTheme() {
            const mode = getCookie('themeMode') || getCookie('theme') || 'light';
            const darkRadio = document.getElementById('theme-dark');
            const lightRadio = document.getElementById('theme-light');
            const autoRadio = document.getElementById('theme-auto');

            if (mode === 'auto') {
                if (autoRadio) autoRadio.checked = true;
                ensureAutoThemeListeners();
                applyAutoTheme();
                return;
            }

            if (mode === 'dark') {
                document.documentElement.classList.add('dark');
                if (darkRadio) darkRadio.checked = true;
            } else {
                document.documentElement.classList.remove('dark');
                if (lightRadio) lightRadio.checked = true;
            }
        }

        let autoThemeMediaQuery = null;
        let autoThemeListenersReady = false;
        let autoBattery = null;

        function ensureAutoThemeListeners() {
            if (autoThemeListenersReady) return;
            autoThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            autoThemeMediaQuery.addEventListener('change', () => {
                if ((getCookie('themeMode') || '') === 'auto') applyAutoTheme();
            });
            if (typeof navigator.getBattery === 'function') {
                navigator.getBattery().then((battery) => {
                    autoBattery = battery;
                    const handler = () => {
                        if ((getCookie('themeMode') || '') === 'auto') applyAutoTheme();
                    };
                    battery.addEventListener('chargingchange', handler);
                    battery.addEventListener('levelchange', handler);
                }).catch(() => { });
            }
            autoThemeListenersReady = true;
        }

        async function applyAutoTheme() {
            let resolved = 'light';
            const mq = autoThemeMediaQuery || window.matchMedia('(prefers-color-scheme: dark)');
            resolved = mq.matches ? 'dark' : 'light';
            const battery = autoBattery;
            if (battery && battery.charging === false && typeof battery.level === 'number' && battery.level <= 0.15) {
                resolved = 'dark';
            }
            setCookie('theme', resolved, 365);
            if (resolved === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        // Funciones para el menú de navegación
        const navMenu = document.querySelector('.nav-menu');
        const menuToggle = document.querySelector('.menu-toggle');
        const menuOverlay = document.querySelector('.menu-overlay');
        let scrollPosition = 0;

        function toggleMenu() {
            const isVisible = navMenu.classList.contains('visible');

            if (!isVisible) {
                scrollPosition = window.pageYOffset;
                document.body.classList.add('menu-open');
                document.body.style.top = `-${scrollPosition}px`;
                menuOverlay.classList.add('visible');
            } else {
                document.body.classList.remove('menu-open');
                document.body.style.top = '';
                window.scrollTo(0, scrollPosition);
                menuOverlay.classList.remove('visible');
            }

            navMenu.classList.toggle('visible');
            menuToggle.classList.toggle('opened');
        }

        if (menuOverlay) {
            menuOverlay.addEventListener('click', toggleMenu);
        }

        // Marcar enlace activo
        function setActiveLink() {
            const rawPage = window.location.pathname.split('/').pop() || 'index.html';
            const routeAliases = {
                'calculadora-roi.html': 'estadisticas.html',
                'tabla-trades.html': 'diario.html'
            };
            const currentPage = routeAliases[rawPage] || rawPage;
            const links = document.querySelectorAll('.menu-items a');

            links.forEach(link => {
                link.classList.remove('active', 'bg-orange-600', 'dark:bg-orange-700', 'text-white');
                link.removeAttribute('aria-current');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active', 'bg-orange-600', 'dark:bg-orange-700', 'text-white');
                    link.setAttribute('aria-current', 'page');
                }
            });
        }

        // --- LÓGICA DE AJUSTES (Adaptada) ---

        // Cargar configuración guardada
        function loadSettings() {
            loadTheme(); // Reutiliza la función de tema

            const monthlyGoal = getCookie('monthlyGoal') || '10000';
            const goalInput = document.getElementById('monthly-goal');
            if (goalInput) goalInput.value = monthlyGoal;

            const goalPeriod = getCookie('goalPeriod') || 'monthly';
            const periodInput = document.getElementById('goal-period');
            if (periodInput) periodInput.value = goalPeriod;

            // Cargar capital inicial
            const initialCapital = localStorage.getItem('initialCapital') || '0';
            const capitalInput = document.getElementById('initial-capital');
            if (capitalInput) capitalInput.value = initialCapital;

            // Cargar nombre de usuario
            const username = localStorage.getItem('username') || '';
            const usernameInput = document.getElementById('username');
            if (usernameInput) usernameInput.value = username;

            const discordWebhookUrl = localStorage.getItem('discordWebhookUrl') || '';
            const webhookInput = document.getElementById('discord-webhook-url');
            if (webhookInput) webhookInput.value = discordWebhookUrl;
        }

        // Guardar configuración
        function saveSettings() {
            const selectedTheme = document.querySelector('input[name="theme"]:checked')?.value || 'light';
            setCookie('themeMode', selectedTheme, 365);

            if (selectedTheme === 'auto') {
                ensureAutoThemeListeners();
                applyAutoTheme();
            } else {
                setCookie('theme', selectedTheme, 365);
                if (selectedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }

            const monthlyGoal = document.getElementById('monthly-goal').value;
            setCookie('monthlyGoal', monthlyGoal, 365);

            const goalPeriod = document.getElementById('goal-period').value;
            setCookie('goalPeriod', goalPeriod, 365);

            alert('Configuración guardada exitosamente');
        }

        // Función para guardar el capital inicial
        function saveInitialCapital() {
            const initialCapital = document.getElementById('initial-capital').value;
            const val = parseFloat(initialCapital);
            if (initialCapital !== '' && !isNaN(val) && val >= 0) {
                localStorage.setItem('initialCapital', initialCapital);
                const timestamp = new Date().toISOString();
                localStorage.setItem('capitalStartDate', timestamp);

                // Guardar en historial
                let history = [];
                try {
                    history = JSON.parse(localStorage.getItem('capitalHistory')) || [];
                } catch (e) { history = []; }
                
                history.push({
                    date: timestamp,
                    amount: val,
                    type: 'initial_capital_update'
                });
                localStorage.setItem('capitalHistory', JSON.stringify(history));

                alert('Capital inicial guardado exitosamente');
            } else {
                alert('Por favor ingrese un valor válido para el capital inicial (positivo).');
            }
        }

        // Función para guardar el nombre de usuario
        function saveUsername() {
            const username = document.getElementById('username').value;
            if (username && username.trim() !== '') {
                localStorage.setItem('username', username);
                alert('Nombre de usuario guardado exitosamente');
            } else {
                alert('Por favor ingrese un nombre de usuario válido');
            }
        }

        function isValidDiscordWebhookUrl(raw) {
            const value = (raw || '').trim();
            if (!value) return false;
            let url;
            try {
                url = new URL(value);
            } catch (error) {
                return false;
            }
            if (url.protocol !== 'https:') return false;
            const host = url.hostname.toLowerCase();
            if (!(/(^|\.)discord\.com$/.test(host) || /(^|\.)discordapp\.com$/.test(host))) return false;
            return url.pathname.includes('/api/webhooks/');
        }

        function saveDiscordWebhookUrl() {
            const input = document.getElementById('discord-webhook-url');
            if (!input) return;
            const value = (input.value || '').trim();
            if (!value) {
                localStorage.removeItem('discordWebhookUrl');
                input.value = '';
                alert('Webhook eliminado.');
                return;
            }
            if (!isValidDiscordWebhookUrl(value)) {
                alert('URL de webhook inválida. Debe ser una URL HTTPS de Discord (api/webhooks/...).');
                return;
            }
            localStorage.setItem('discordWebhookUrl', value);
            alert('Webhook guardado exitosamente');
        }

        function clearDiscordWebhookUrl() {
            const input = document.getElementById('discord-webhook-url');
            localStorage.removeItem('discordWebhookUrl');
            if (input) input.value = '';
            alert('Webhook eliminado.');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            setActiveLink();

            document.querySelectorAll('input[name="theme"]').forEach(radio => {
                radio.addEventListener('change', saveSettings);
            });

            const saveGoalBtn = document.getElementById('save-goal');
            if (saveGoalBtn) saveGoalBtn.addEventListener('click', saveSettings);

            const saveCapitalBtn = document.getElementById('save-capital');
            if (saveCapitalBtn) saveCapitalBtn.addEventListener('click', saveInitialCapital);

            const saveUsernameBtn = document.getElementById('save-username');
            if (saveUsernameBtn) saveUsernameBtn.addEventListener('click', saveUsername);

            const saveWebhookBtn = document.getElementById('save-discord-webhook');
            if (saveWebhookBtn) saveWebhookBtn.addEventListener('click', saveDiscordWebhookUrl);

            const clearWebhookBtn = document.getElementById('clear-discord-webhook');
            if (clearWebhookBtn) clearWebhookBtn.addEventListener('click', clearDiscordWebhookUrl);
        });

    </script>
</body>

</html>
