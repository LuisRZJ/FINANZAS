<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Inversiones</title>
    <meta name="theme-color" content="#2563eb">
    <link rel="icon" href="/pwa/logo-app.png">
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/styles.css">

    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 900px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .result-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .result-box {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 4px;
            background-color: var(--light);
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .positive {
            color: var(--success);
            font-weight: 700;
        }
        
        .negative {
            color: var(--danger);
            font-weight: 700;
        }
        
        .neutral {
            color: var(--warning);
            font-weight: 700;
        }
        
        .hidden {
            display: none;
        }
        
        .summary-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .technical-details {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--warning);
            font-size: 14px;
        }
        
        .period-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .back-button-container {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .back-btn-custom {
            background-color: var(--dark);
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .back-btn-custom:hover {
            background-color: #2c3e50;
        }

        @media (max-width: 600px) {
            .back-btn-custom {
                width: 90%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Calculadora de Inversiones</h1>
            <p class="subtitle">Evalúa la rentabilidad de tus proyectos de inversión</p>
        </header>
        
        <div class="calculator-grid">
            <div class="input-section">
                <h2>Datos de la Inversión</h2>
                <form id="investment-form">
                    <div class="form-group">
                        <label for="start-date">Fecha de inicio</label>
                        <input type="date" id="start-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Periodo de inversión</label>
                        <div class="period-inputs">
                            <div>
                                <label for="period-value">Duración</label>
                                <input type="number" id="period-value" min="1" value="12" required>
                            </div>
                            <div>
                                <label for="period-type">Tipo de periodo</label>
                                <select id="period-type">
                                    <option value="days">Días</option>
                                    <option value="months">Meses</option>
                                    <option value="years" selected>Años</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="initial-investment">Inversión inicial ($)</label>
                        <input type="number" id="initial-investment" min="0" step="0.01" placeholder="Ej: 10000" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="maintenance-cost">Costos de mantenimiento mensuales ($)</label>
                        <input type="number" id="maintenance-cost" min="0" step="0.01" placeholder="Ej: 100" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="expected-return">Ganancia esperada por periodo ($)</label>
                        <input type="number" id="expected-return" min="0" step="0.01" placeholder="Ej: 500" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="return-frequency">Frecuencia de ganancia</label>
                        <select id="return-frequency">
                            <option value="daily">Diaria</option>
                            <option value="weekly">Semanal</option>
                            <option value="monthly" selected>Mensual</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="yearly">Anual</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="inflation-rate">Tasa de inflación anual estimada (%)</label>
                        <input type="number" id="inflation-rate" min="0" step="0.1" placeholder="Ej: 2.5" value="2.5">
                    </div>
                    
                    <button type="submit">Calcular Rentabilidad</button>
                </form>
            </div>
            
            <div class="result-section">
                <h2>Resultados del Análisis</h2>
                <div id="results-container">
                    <div class="result-box">
                        <div class="result-title">Rentabilidad de la inversión</div>
                        <div id="profitability-result">Ingresa los datos y calcula</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Ganancia neta total</div>
                        <div id="net-profit">-</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Tiempo para recuperar la inversión (Break Even)</div>
                        <div id="break-even">-</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Días de ganancia libre después del Break Even</div>
                        <div id="free-days">-</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Retorno sobre la inversión (ROI)</div>
                        <div id="roi">-</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title">Valor actual neto (VAN)</div>
                        <div id="van">-</div>
                    </div>
                    
                    <div id="non-profitable-alert" class="technical-details hidden">
                        <h3>⚠️ Análisis de Inversión No Rentable</h3>
                        <p>Nuestro análisis indica que esta inversión no sería rentable con los parámetros actuales. Considera:</p>
                        <ul>
                            <li>Reducir costos de mantenimiento</li>
                            <li>Aumentar las ganancias esperadas</li>
                            <li>Extender el periodo de inversión</li>
                            <li>Reevaluar los supuestos de ganancia</li>
                        </ul>
                    </div>
                    
                    <div id="summary-card" class="summary-card hidden">
                        <h3>Resumen de tu Inversión</h3>
                        <div id="summary-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="back-button-container">
        <a href="../utilidades.html" class="btn back-btn-custom">
            <i class="fas fa-arrow-left"></i> Volver a Utilidades
        </a>
    </div>

     <footer>
        <p>Versión: <span id="appVersion"></span> | Última Actualización: <span id="appDate"></span></p>
    </footer>

    <script src="../app.js"></script>

    <!-- Script del pie de página -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appVersionElement = document.getElementById('appVersion');
            const appDateElement = document.getElementById('appDate');

            if (typeof PAGE_VERSION !== 'undefined') {
                appVersionElement.textContent = PAGE_VERSION;
            }
            if (typeof ACT_DATE !== 'undefined') {
                appDateElement.textContent = ACT_DATE;
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer fecha mínima como hoy
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('start-date').value = formattedDate;
            document.getElementById('start-date').min = formattedDate;
            
            // Manejar el envío del formulario
            document.getElementById('investment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateInvestment();
            });
        });
        
        function calculateInvestment() {
            // Obtener valores del formulario
            const startDate = new Date(document.getElementById('start-date').value);
            const periodValue = parseFloat(document.getElementById('period-value').value);
            const periodType = document.getElementById('period-type').value;
            const initialInvestment = parseFloat(document.getElementById('initial-investment').value);
            const maintenanceCost = parseFloat(document.getElementById('maintenance-cost').value) || 0;
            const expectedReturn = parseFloat(document.getElementById('expected-return').value);
            const returnFrequency = document.getElementById('return-frequency').value;
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 0;
            
            // Calcular fecha final según el periodo
            const endDate = calculateEndDate(startDate, periodValue, periodType);
            
            // Calcular número de periodos de ganancia
            const returnPeriods = calculateReturnPeriods(startDate, endDate, returnFrequency);
            
            // Calcular ganancia bruta total
            const grossProfit = expectedReturn * returnPeriods;
            
            // Calcular costos totales
            const totalMaintenanceCost = calculateMaintenanceCost(startDate, endDate, maintenanceCost);
            const totalCosts = initialInvestment + totalMaintenanceCost;
            
            // Calcular ganancia neta
            const netProfit = grossProfit - totalCosts;
            
            // Calcular tiempo para break even
            const breakEvenData = calculateBreakEven(initialInvestment, maintenanceCost, expectedReturn, returnFrequency);
            
            // Calcular días libres después del break even
            const freeDaysAfterBreakEven = calculateFreeDaysAfterBreakEven(startDate, endDate, breakEvenData.breakEvenDate);
            
            // Calcular ROI
            const roi = (netProfit / totalCosts) * 100;
            
            // Calcular VAN (Valor Actual Neto)
            const van = calculateVAN(initialInvestment, maintenanceCost, expectedReturn, returnFrequency, inflationRate, periodValue, periodType);
            
            // Mostrar resultados
            displayResults({
                profitable: netProfit > 0,
                netProfit: netProfit,
                grossProfit: grossProfit,
                totalCosts: totalCosts,
                breakEvenDays: breakEvenData.breakEvenDays,
                breakEvenDate: breakEvenData.breakEvenDate,
                freeDaysAfterBreakEven: freeDaysAfterBreakEven,
                roi: roi,
                van: van,
                startDate: startDate,
                endDate: endDate,
                returnPeriods: returnPeriods
            });
        }
        
        function calculateEndDate(startDate, periodValue, periodType) {
            const endDate = new Date(startDate);
            
            switch(periodType) {
                case 'days':
                    endDate.setDate(endDate.getDate() + periodValue);
                    break;
                case 'months':
                    endDate.setMonth(endDate.getMonth() + periodValue);
                    break;
                case 'years':
                    endDate.setFullYear(endDate.getFullYear() + periodValue);
                    break;
            }
            
            return endDate;
        }
        
        function calculateReturnPeriods(startDate, endDate, returnFrequency) {
            const timeDiff = Math.abs(endDate - startDate);
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            
            switch(returnFrequency) {
                case 'daily':
                    return daysDiff;
                case 'weekly':
                    return Math.floor(daysDiff / 7);
                case 'monthly':
                    return Math.floor(daysDiff / 30);
                case 'quarterly':
                    return Math.floor(daysDiff / 90);
                case 'yearly':
                    return Math.floor(daysDiff / 365);
                default:
                    return 0;
            }
        }
        
        function calculateMaintenanceCost(startDate, endDate, monthlyCost) {
            const timeDiff = Math.abs(endDate - startDate);
            const monthsDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24 * 30));
            return monthlyCost * monthsDiff;
        }
        
        function calculateBreakEven(initialInvestment, maintenanceCost, expectedReturn, returnFrequency) {
            // Calcular ganancia diaria aproximada según frecuencia
            let dailyGain = 0;
            
            switch(returnFrequency) {
                case 'daily':
                    dailyGain = expectedReturn;
                    break;
                case 'weekly':
                    dailyGain = expectedReturn / 7;
                    break;
                case 'monthly':
                    dailyGain = expectedReturn / 30;
                    break;
                case 'quarterly':
                    dailyGain = expectedReturn / 90;
                    break;
                case 'yearly':
                    dailyGain = expectedReturn / 365;
                    break;
            }
            
            // Calcular costo diario de mantenimiento
            const dailyMaintenanceCost = maintenanceCost / 30;
            
            // Ganancia neta diaria
            const dailyNetGain = dailyGain - dailyMaintenanceCost;
            
            if (dailyNetGain <= 0) {
                return {
                    breakEvenDays: Infinity,
                    breakEvenDate: null
                };
            }
            
            // Días necesarios para recuperar la inversión inicial
            const breakEvenDays = initialInvestment / dailyNetGain;
            
            // Calcular fecha de break even
            const breakEvenDate = new Date();
            breakEvenDate.setDate(breakEvenDate.getDate() + breakEvenDays);
            
            return {
                breakEvenDays: breakEvenDays,
                breakEvenDate: breakEvenDate
            };
        }
        
        function calculateFreeDaysAfterBreakEven(startDate, endDate, breakEvenDate) {
            if (!breakEvenDate || breakEvenDate > endDate) {
                return 0;
            }
            
            const timeDiff = Math.abs(endDate - breakEvenDate);
            return Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
        }
        
        function calculateVAN(initialInvestment, maintenanceCost, expectedReturn, returnFrequency, inflationRate, periodValue, periodType) {
            // Esta es una simplificación. Un cálculo real de VAN requeriría flujos de caja más detallados.
            const monthlyInflation = Math.pow(1 + (inflationRate / 100), 1/12) - 1;
            
            // Calcular ganancia mensual aproximada
            let monthlyGain = 0;
            
            switch(returnFrequency) {
                case 'daily':
                    monthlyGain = expectedReturn * 30;
                    break;
                case 'weekly':
                    monthlyGain = expectedReturn * 4;
                    break;
                case 'monthly':
                    monthlyGain = expectedReturn;
                    break;
                case 'quarterly':
                    monthlyGain = expectedReturn / 3;
                    break;
                case 'yearly':
                    monthlyGain = expectedReturn / 12;
                    break;
            }
            
            // Calcular flujo neto mensual
            const netMonthlyCashFlow = monthlyGain - maintenanceCost;
            
            // Calcular número de meses
            let totalMonths = 0;
            
            switch(periodType) {
                case 'days':
                    totalMonths = periodValue / 30;
                    break;
                case 'months':
                    totalMonths = periodValue;
                    break;
                case 'years':
                    totalMonths = periodValue * 12;
                    break;
            }
            
            // Calcular VAN simplificado
            let van = -initialInvestment;
            
            for (let i = 1; i <= totalMonths; i++) {
                van += netMonthlyCashFlow / Math.pow(1 + monthlyInflation, i);
            }
            
            return van;
        }
        
        function displayResults(data) {
            // Mostrar rentabilidad
            const profitabilityElement = document.getElementById('profitability-result');
            if (data.profitable) {
                profitabilityElement.innerHTML = `<span class="positive">✓ INVERSIÓN RENTABLE</span>`;
            } else {
                profitabilityElement.innerHTML = `<span class="negative">✗ INVERSIÓN NO RENTABLE</span>`;
            }
            
            // Mostrar ganancia neta
            document.getElementById('net-profit').textContent = 
                `${formatCurrency(data.netProfit)} (Bruta: ${formatCurrency(data.grossProfit)} - Costos: ${formatCurrency(data.totalCosts)})`;
            
            // Mostrar break even
            const breakEvenElement = document.getElementById('break-even');
            if (data.breakEvenDays === Infinity) {
                breakEvenElement.innerHTML = `<span class="negative">No se alcanzaría el punto de equilibrio</span>`;
            } else {
                breakEvenElement.textContent = 
                    `${Math.ceil(data.breakEvenDays)} días (approx. ${data.breakEvenDate.toLocaleDateString()})`;
            }
            
            // Mostrar días libres
            document.getElementById('free-days').textContent = 
                `${data.freeDaysAfterBreakEven} días de ganancia libre`;
            
            // Mostrar ROI
            const roiElement = document.getElementById('roi');
            roiElement.textContent = `${data.roi.toFixed(2)}%`;
            if (data.roi > 0) {
                roiElement.classList.add('positive');
                roiElement.classList.remove('negative');
            } else {
                roiElement.classList.add('negative');
                roiElement.classList.remove('positive');
            }
            
            // Mostrar VAN
            const vanElement = document.getElementById('van');
            vanElement.textContent = `${formatCurrency(data.van)}`;
            if (data.van > 0) {
                vanElement.classList.add('positive');
                vanElement.classList.remove('negative');
            } else {
                vanElement.classList.add('negative');
                vanElement.classList.remove('positive');
            }
            
            // Mostrar/ocultar alerta de no rentabilidad
            const alertElement = document.getElementById('non-profitable-alert');
            if (!data.profitable) {
                alertElement.classList.remove('hidden');
            } else {
                alertElement.classList.add('hidden');
            }
            
            // Mostrar resumen
            const summaryElement = document.getElementById('summary-card');
            const summaryContent = document.getElementById('summary-content');
            summaryElement.classList.remove('hidden');
            
            summaryContent.innerHTML = `
                <p><strong>Periodo de inversión:</strong> ${data.startDate.toLocaleDateString()} - ${data.endDate.toLocaleDateString()}</p>
                <p><strong>Total periodos de ganancia:</strong> ${data.returnPeriods}</p>
                <p><strong>Ganancia por periodo:</strong> ${formatCurrency(parseFloat(document.getElementById('expected-return').value))}</p>
                <p><strong>Inversión inicial:</strong> ${formatCurrency(parseFloat(document.getElementById('initial-investment').value))}</p>
            `;
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(amount);
        }
    </script>
</body>
</html>